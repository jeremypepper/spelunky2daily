(this["webpackJsonpspelunky2-daily-leaderboards"]=this["webpackJsonpspelunky2-daily-leaderboards"]||[]).push([[0],{114:function(e,t,n){},115:function(e,t,n){"use strict";n.r(t);var a=n(48),r=n.n(a),c=n(62),i=n(1),l=n(2),s=n.n(l),o=n(63),d=n.n(o),u=(n(77),n(16)),j=(n(78),n(8)),h=n.n(j),b=n(47),f=n(131),p=n(126),O=n(127),m=n(128),x=n(129),v=n(125),y=n(64),D=n.n(y),g=n(130),w=n(9),S=n(34),F=n.n(S),N=n(21),k=n.n(N);function L(e){var t=function(e){return e.level}(e);return t>23?23:t}function P(e){if(!e.dayData)return null;for(var t,n=(t=e.dayData,h.a.countBy(t,L)),a=[0],r=h.a.max(h.a.keys(n).map((function(e){return Number.parseInt(e,10)}))),c=1;c<=r;c++)a[c]=n[c]||0;var l={chart:{type:"column"},plotOptions:{column:{colorByPoint:!0},series:{minPointLength:3}},colors:["#8B786D","#8B786D","#8B786D","#8B786D","#8B786D","#590925","#590925","#590925","#590925","#F6AA1C","#16425B","#16425B","#16425B","#16425B","#78A1BB","#DAD4EF","#DAD4EF","#DAD4EF","#DAD4EF","#9CDE9F","#9CDE9F","#9CDE9F","#9CDE9F","#002626"],title:{text:"Maximum World Reached"},credits:{enabled:!1},legend:{enabled:!1},yAxis:{title:{text:"Number of Players"}},xAxis:{min:1,max:23,tickPositions:[1,5,9,10,14,15,19,23],labels:{formatter:function(){var e=Object(w.getLevelDefinition)(this.value);return 23===e.value?"ocean":"".concat(e.toString())}},crosshair:!0},series:[{name:"WorldEntered",data:a}],tooltip:{formatter:function(){var e=Object(w.getLevelDefinition)(this.x);return"".concat(e.worldName," ").concat(e.toString(),"<br/>").concat(this.y," players")}}},s=function(){return Object(i.jsx)("div",{children:Object(i.jsx)(F.a,{highcharts:k.a,options:l})})};return Object(i.jsx)(s,{})}var C="localhost"===window.location.hostname?"http://localhost:8010/proxy":"https://spelunky2daily.s3-us-west-2.amazonaws.com";function B(e){return fetch(C+e)}function E(e){var t=D()({table:{minWidth:650}})();if(!e.dayData)return null;var n=e.filterCount?h.a.take(e.dayData,e.filterCount):e.dayData,a=h.a.map(n,(function(e){var t=Object(w.getLevelDefinition)(e.level),n=window.encodeURIComponent(Object(w.getPlayerUniqueId)(e.platform,e.id));return Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:Object(i.jsx)("a",{href:"?player=".concat(n),children:e.name})}),Object(i.jsx)(f.a,{children:Object(w.getPlatformName)(e.platform)}),Object(i.jsx)(f.a,{children:t.toString()}),Object(i.jsx)(f.a,{children:e.percentile.toFixed(2)})]},e.uniqueId)}));return Object(i.jsx)("div",{children:Object(i.jsx)(p.a,{component:O.a,children:Object(i.jsxs)(m.a,{className:t.table,size:"small",children:[Object(i.jsx)(x.a,{children:Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:"Name"}),Object(i.jsx)(f.a,{children:"Platform"}),Object(i.jsx)(f.a,{children:"Level"}),Object(i.jsx)(f.a,{children:"Percentile"})]})}),Object(i.jsx)(g.a,{children:a})]})})})}var A=function(e){var t=Object(l.useState)(100),n=Object(u.a)(t,2),a=n[0],r=n[1],c=window.lastDayJSON;function s(e,t){var n=b.DateTime.fromMillis(Object(w.parseDate)(e)).plus({days:t}),a=n.toUTC().toFormat("yyyy-MM-dd");return function(e){return h.a.includes(c.dates,e)}(a)?a:null}function o(){r(null)}var d=Object(l.useState)(null),j=Object(u.a)(d,2),f=j[0],p=j[1],O=e.day;Object(l.useEffect)((function(){B("/processeddates/"+O+".json").then((function(e){return e.json()})).then((function(e){p(e)}))}),[O]);var m=function(e){return s(e,-1)}(O),x=function(e){return s(e,1)}(O),v=m?Object(i.jsx)("a",{href:"?day="+m,children:"Previous Day"}):null,y=x?Object(i.jsx)("a",{href:"?day="+x,children:"Next Day"}):null;return Object(i.jsxs)("div",{className:"App",children:[Object(i.jsxs)("header",{children:[Object(i.jsxs)("div",{className:"main",children:["Daily Challenge for ",O]}),Object(i.jsxs)("div",{className:"subtitle",children:["Data Provided by "," ",Object(i.jsx)("a",{href:"http://vdzserver.org/spelunky2",children:"http://vdzserver.org/spelunky2"})]}),Object(i.jsxs)("nav",{className:"day-nav",children:[v,y,Object(i.jsx)("a",{href:"?path=leaderboards",children:"Leaderboards"})]})]}),Object(i.jsx)("div",{className:"histogram-wrapper",children:Object(i.jsx)(P,{dayData:f})}),a?Object(i.jsxs)("div",{className:"filterbar",children:["Showing Top 100 players ",Object(i.jsx)("button",{onClick:o,children:"Show All"})]}):null,Object(i.jsx)(E,{dayData:f,filterCount:a}),a?Object(i.jsxs)("div",{className:"filterbar",children:["Showing Top 100 players ",Object(i.jsx)("button",{onClick:o,children:"Show All"})]}):null]})},I=(n(114),n(47).DateTime);var M=function(e){var t=Object(l.useState)(null),n=Object(u.a)(t,2),a=n[0],r=n[1],c=Object(l.useState)(null),s=Object(u.a)(c,2),o=s[0],d=s[1],j=e.player;if(Object(l.useEffect)((function(){var e;(e=j,fetch("https://q4hpqdiprh.execute-api.us-west-2.amazonaws.com/prod/player?uniqueid="+window.encodeURIComponent(e)).then((function(e){return e.json()})).then((function(e){return null===e||void 0===e?void 0:e.data}))).then((function(e){r(e)}))}),[j]),Object(l.useEffect)((function(){B("/percentilesByDate.json").then((function(e){return e.json()})).then((function(e){return d(e)}))}),[]),!a)return null;function b(e,t){return Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:e}),Object(i.jsx)(f.a,{children:t})]})}var p,O=[b("Best Rank","".concat(a.rankSummary.min," (").concat(a.percentileSummary.max.toFixed(2),")%")),b("Median Rank","".concat(a.rankSummary.median," (").concat(a.percentileSummary.median.toFixed(2),")%"))],y=h.a.map(a.scoreData,(function(e,t){return function(e,t){return Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:e}),Object(i.jsx)(f.a,{children:Object(w.getLevelDefinition)(t.level).toString()}),Object(i.jsx)(f.a,{children:t.score}),Object(i.jsx)(f.a,{children:(t.runframes/60).toFixed(3)}),Object(i.jsx)(f.a,{children:t.rank}),Object(i.jsx)(f.a,{children:t.percentile.toFixed(2)})]})}(t,e)})),D=(p=a.scoreData,h.a.map(p,(function(e,t){return[Object(w.parseDate)(t),e.level]})).reverse()),S=[],N=[],L=[],P=[],C=[],E=[],A=[];h.a.forEach(D,(function(e){var t=I.fromMillis(e[0],{zone:"UTC"}),n=o[t.toString()];n&&(S.push([e[0],n.p25]),N.push([e[0],n.p50]),L.push([e[0],n.p75]),P.push([e[0],n.p80]),C.push([e[0],n.p90]),E.push([e[0],n.p95]),A.push([e[0],n.p99]))}));var M={credits:{enabled:!1},chart:{type:"spline"},title:{text:"Depth Over Time"},tooltip:{headerFormat:"<b>{series.name}</b><br>",pointFormat:"{point.x:%m-%d}: {point.y}",formatter:function(){var e=Object(w.getLevelDefinition)(this.y),t=k.a.dateFormat("%m-%d-%Y",new Date(this.x));return"".concat(t," <br/>").concat(e.worldName," ").concat(e.toString(),"<br/>")}},xAxis:{type:"datetime",title:{text:"Daily"}},yAxis:{title:{text:"Depth (floors reached)"},min:1,labels:{formatter:function(){var e=Object(w.getLevelDefinition)(this.value);return 23===e.value?"ocean":"".concat(e.toString())}}},legend:{enabled:!0},series:[{name:a.name,data:D},{name:"50th percentile (avg score of all players)",color:"#DDDDDD",dashStyle:"ShortDash",data:N}]},R=function(){return Object(i.jsx)("div",{children:Object(i.jsx)(F.a,{highcharts:k.a,options:M})})};return Object(i.jsxs)("div",{children:[Object(i.jsxs)("div",{className:"title",children:[a.name," ",Object(i.jsx)("span",{className:"platformname",children:Object(w.getPlayerPlatformFromUniqueId)(a.uniqueId).platformName})]}),Object(i.jsx)(m.a,{children:Object(i.jsx)(g.a,{children:O})}),Object(i.jsx)(R,{}),Object(i.jsxs)(m.a,{children:[Object(i.jsxs)(x.a,{children:[Object(i.jsx)(f.a,{children:"date"}),Object(i.jsx)(f.a,{children:"level"}),Object(i.jsx)(f.a,{children:"score"}),Object(i.jsx)(f.a,{children:"time"}),Object(i.jsx)(f.a,{children:"rank"}),Object(i.jsx)(f.a,{children:"percentile"})]}),Object(i.jsx)(g.a,{children:y})]})]})};function R(){var e=Object(l.useState)(null),t=Object(u.a)(e,2),n=t[0],a=t[1];Object(l.useEffect)((function(){B("/tenDayLevelScoreList.json").then((function(e){return e.json()})).then((function(e){console.log("processingdata");for(var t=Math.min(e.length,1e3),n=0;n<t;n++){var a=e[n],r=0;console.log("player data length is",a.tenDayLevelsReached.length);for(var c=0;c<a.tenDayLevelsReached.length;c++){var i=a.tenDayLevelsReached[c];i&&(r+=i*Math.pow(.9,c))}a.totalScore=r,n%100===0&&console.log("processing progress "+n)}return h()(e).filter("totalScore").sortBy("totalScore").reverse().value()})).then((function(e){return console.log("setplayerdata"),a(e)}))}),[]);var r=h()(n).map((function(e,t){var n=h.a.map(e.tenDayLevelsReached,(function(e){return Object(w.getLevelDefinition)(e).toString()}));return Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:t+1}),Object(i.jsx)(f.a,{children:e.name}),Object(i.jsx)(f.a,{children:e.totalScore.toFixed(2)}),h.a.map(n,(function(t,n){return Object(i.jsx)(f.a,{style:{whiteSpace:"nowrap"},children:t},e.uniqueId+n)}))]},e.uniqueId)})).value();return console.log("render?"),Object(i.jsxs)("div",{children:[Object(i.jsxs)("header",{children:["Spelunky 2 Leaderboards",Object(i.jsx)("div",{className:"subtitle",children:"Calculated using the last 10 days. More recent days have a higher influence on total score"})]}),Object(i.jsxs)("div",{style:{width:1024},children:[Object(i.jsxs)(m.a,{size:"small",children:[Object(i.jsx)(x.a,{children:Object(i.jsxs)(v.a,{children:[Object(i.jsx)(f.a,{children:"Rank"}),Object(i.jsx)(f.a,{children:"Player"}),Object(i.jsx)(f.a,{children:"Total Ten Day Score"}),Object(i.jsx)(f.a,{colSpan:10,children:"Results"})]})}),Object(i.jsx)(g.a,{children:r})]}),Object(i.jsx)("footer",{})]})]})}var T=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,132)).then((function(t){var n=t.getCLS,a=t.getFID,r=t.getFCP,c=t.getLCP,i=t.getTTFB;n(e),a(e),r(e),c(e),i(e)}))};function q(){return(q=Object(c.a)(r.a.mark((function e(){var t,n,a,c,l;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B("/latest-date.json").then((function(e){return e.json()}));case 2:window.lastDayJSON=e.sent,t=new URLSearchParams(window.location.search),a=t.get("player"),c=t.get("path"),l=t.get("day")||window.lastDayJSON.date,n=a?Object(i.jsx)(M,{player:a}):"leaderboards"===c?Object(i.jsx)(R,{}):Object(i.jsx)(A,{day:l}),d.a.render(Object(i.jsx)(s.a.StrictMode,{children:n}),document.getElementById("root"));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){q.apply(this,arguments)}(),T()},77:function(e,t,n){},78:function(e,t,n){},9:function(e,t,n){var a=n(81),r=n(82),c=n(83),i=n(89).DateTime;function l(e){return 18===Number.parseInt(e,10)?"Steam":"Playstation"}var s=function(){"use strict";function e(t,n,r,c){a(this,e),this.value=t,this.world=n,this.sublevel=r,this.worldName=c}return r(e,[{key:"toString",value:function(){return 0===this.world&&0===this.sublevel?"":"".concat(this.world,"-").concat(this.sublevel)}}]),e}();e.exports={parseDate:function(e){return i.fromFormat(e,"yyyy-MM-dd",{zone:"utc"}).valueOf()},getLevelDefinition:function(e){return null==e?new s(0,0,0,""):e<=4?new s(e,1,e,"dwelling"):e<=8?new s(e,2,e-4,"volcana/jungle"):9===e?new s(e,3,1,"olmec"):e<=13?new s(e,4,e-9,"tidepool/temple"):e<=14?new s(e,5,1,"icecaves"):e<=18?new s(e,6,e-14,"neobabylon"):new s(e,7,e-18,e<=22?"sunkencity":"cosmic ocean")},getPlayerUniqueId:function(e,t){return"".concat(e,"|").concat(t)},getPlatformName:l,getPlayerPlatformFromUniqueId:function(e){var t=e.split("|"),n=c(t,2),a=n[0];return{player:n[1],platform:a,platformName:l(a)}}}}},[[115,1,2]]]);
//# sourceMappingURL=main.6e7ff79d.chunk.js.map